class DmC_info extends egret.DisplayObjectContainer{
    private _tx:egret.Bitmap;
    private _txName:egret.TextField;
    private _title:egret.TextField;
    private _content:egret.TextField;
    private _bj1:egret.Shape;
    private _bj1zz:egret.Shape;
    private _bj2:egret.Bitmap;
    private _bj1Text:egret.TextField;
    private _bj2Text:egret.TextField;
    private _time:egret.TextField;
    private _type:egret.TextField;
    private _multiple:egret.TextField;
    private _multipleText:egret.TextField;
    private _nowBtn:egret.Bitmap;
    private _money:egret.TextField;
    private _link:egret.Shape;
    private _item:GHashMap<DmC_info_info>;

    private _data:DmC_infoData;
    constructor(){
        super();
        this._item = new GHashMap<DmC_info_info>();

        this._tx = new egret.Bitmap();
        this.addChild(this._tx);
        this._tx.touchEnabled = true;
        this._tx.width = 80;
        this._tx.height = 80;
        this._tx.x = 28;
        this._tx.y = 32;

        this._txName = ToolMrg.getText(128,30,28,0x333333);
        this.addChild(this._txName);

        let zgBtn = new egret.Bitmap();
        this.addChild(zgBtn);
        zgBtn.x = 614;
        zgBtn.y = 34;
        RES.getResByUrl("resource/assets/images/ui/zgzg_expert@2x.png",(e)=>{zgBtn.$setBitmapData(e); },this);

        this._bj1 = new egret.Shape();
        this.addChild(this._bj1);
        this._bj1.graphics.beginFill(0xf72e52);
        this._bj1.graphics.drawRoundRect(128,86,150,26,15);

        this._bj1zz = new egret.Shape();
        this.addChild(this._bj1zz);
        this._bj1zz.graphics.beginFill(0xffffff);
        this._bj1zz.graphics.drawRoundRect(129.5,87.5,147,23,15);

        this._bj2 = new egret.Bitmap();
        this.addChild(this._bj2);
        this._bj2.x = 290;
        this._bj2.y = 86;
        RES.getResByUrl("resource/assets/images/ui/cdbg_expert@2x.png",(e)=>{this._bj2.$setBitmapData(e); },this);
        
        this._bj1Text = ToolMrg.getText(128,86,18,0xf72e52,150);
        this.addChild(this._bj1Text);
        this._bj1Text.height = 26;
        this._bj1Text.verticalAlign = egret.VerticalAlign.MIDDLE;
        this._bj1Text.textAlign = egret.HorizontalAlign.CENTER;

        this._bj2Text = ToolMrg.getText(290,86,18,0xffffff,92);
        this.addChild(this._bj2Text);
        this._bj2Text.height = 26;
        this._bj2Text.textAlign = egret.HorizontalAlign.CENTER;
        this._bj2Text.verticalAlign = egret.VerticalAlign.MIDDLE;

        this._type = ToolMrg.getText(128,138,20,0x333333);
        this.addChild(this._type);

        this._time = ToolMrg.getText(276,138,20,0x999999);
        this.addChild(this._time);

        this._multiple = ToolMrg.getText(650,102,28,0xf72e52);
        this.addChild(this._multiple);

        this._multipleText = ToolMrg.getText(650,136,18,0x999999);
        this.addChild(this._multipleText);
        this._multipleText.text = "预计回报";

        this._content = ToolMrg.getText(128,184,28,0x333333);
        this.addChild(this._content);

        this._money = ToolMrg.getText(128,242,24,0x333333);
        this.addChild(this._money);

        this._nowBtn = new egret.Bitmap();
        this.addChild(this._nowBtn);
        this._nowBtn.x = 582;
        this._nowBtn.y = 238;
        RES.getResByUrl("resource/assets/images/ui/ljcd_expert@2x.png",(e)=>{this._nowBtn.$setBitmapData(e); },this);

        this._link = new egret.Shape();
        this.addChild(this._link);
        this._link.graphics.beginFill(0xdedede);
        this._link.graphics.drawRect(0,310,750,1.5);

        this.setDB();
    }


    public aa(data:DmC_infoData):void{
        this._data = data;

        if(data.txSrc!=undefined && data.txSrc!=""){
            LoadNetPic.getLoadNetPic.loadPic(data.txSrc,(e)=>{this._tx.$setBitmapData(e); },this);
        }else{
            RES.getResByUrl("resource/assets/images/ui/user_default@2x.png",(e)=>{this._tx.$setBitmapData(e); },this);
        }
        this._txName.text = data.txName;
        this._bj1Text.text = "7单回报率220%";
        this._bj2Text.text = "20人跟单";
        this._type.text = `${data.type} 单关`;
        this._time.text = "06-05 02:30 截止";
        this._multiple.textFlow = <Array<egret.ITextElement>>[
            {text:data.multiple,style:{"size":28}},
            {text:"倍",style:{"size":18}}
        ];
        this._content.text = ToolMrg.nameMode2(21,data.content);
        this._money.textFlow = <Array<egret.ITextElement>>[
            {text:"自购：",style:{"textColor":0x333333}},
            {text:data.money,style:{"textColor":0xFC861A}},
            {text:"元",style:{"textColor":0x333333}}
        ];

        if(data.item.size>0){
            let objHeight = 232;
            for(let key of data.item.keys){
                let obj:DmC_info_info;
                if(this._item.GhasKey(key)){
                    obj = this._item.Gget(key);
                }else{
                    obj = new DmC_info_info();
                    this._item.Gput(key,obj);
                }
                obj.aa(data.item.Gget(key));
                obj.y = objHeight;
                objHeight = objHeight + obj.height + 5;
                obj.x = 128;
                if(obj.parent==undefined)
                    this.addChild(obj);
            }

            this._nowBtn.y = objHeight+18;
            this._money.y = objHeight+22;            
        }else{
            this._nowBtn.y = 238;
            this._money.y = 242;
        }

        this._link.graphics.clear();
        this._link.graphics.beginFill(0xdedede);
        this._link.graphics.drawRect(0,this._money.y+this._money.textHeight+34,750,1.5);

        this._mShareC.graphics.clear();
        this._mShareC.graphics.beginFill(0xffffff, 1);
        this._mShareC.graphics.drawRect(0, 0, GameMain.getInstance.StageWidth,this._money.y+this._money.textHeight+36);

    }

    private _isInterception=false;
    public addInterception():void{
        if(!this._isInterception){
            this._tx.addEventListener(egret.TouchEvent.TOUCH_TAP,this.touchDown,this);
            this._mShareC.addEventListener(egret.TouchEvent.TOUCH_TAP,this.touchDown,this);
            this._isInterception = true;
        }
    }

    public removeInterception():void{
        if(this._isInterception){
            this._tx.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.touchDown,this);
            this._mShareC.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.touchDown,this);
            this._isInterception = false;
        }
    }

    private _mShareC: egret.Shape;
	/**适配处理 */
	private setDB(): void {
		this._mShareC = new egret.Shape();
		this._mShareC.graphics.beginFill(0xffffff, 1);
		this._mShareC.graphics.drawRect(0, 0, GameMain.getInstance.StageWidth,312);
		this.addChildAt(this._mShareC, 0);
        this._mShareC.touchEnabled = true;
	}

    private touchDown(e:egret.TouchEvent):void{
        if(e.target == this._mShareC){
            DmC_infoMsg.dmdetail = new DmDetails();
            DmC_infoMsg.dmdetail.show();
        }else if(e.target == this._tx){
            DmC_infoMsg.personalHome = new PersonalHome();
            DmC_infoMsg.personalHome.show();
        }
    }

}

class DmC_infoMsg{
    private static _mInstance: DmC_infoMsg;
	public static get getInstance(): DmC_infoMsg {
		if (DmC_infoMsg._mInstance == undefined)
			DmC_infoMsg._mInstance = new DmC_infoMsg();
		return DmC_infoMsg._mInstance;
	}
    public item:GHashMap<DmC_infoData>;
    /**方案详情页 */
    public static dmdetail:DmDetails;
    /**方案详情页id */
    public static dmdID;
    /**个人主页 */
    public static personalHome:PersonalHome;
    /**个人主页ID 记录上一个个人主页的id */
    public static phID;

    constructor(){
        this.item = new GHashMap<DmC_infoData>();
    }
}

class DmC_infoData{
    public id;
    public txSrc:string;
    public txName:string;
    public title:string;
    /**类型 */
    public type:string;
    public content:string;
    public money:string;
    public time:number;
    /**倍数 */
    public multiple
    public item:GHashMap<DmC_info_infoData>;
    constructor(){
        this.item = new GHashMap<DmC_info_infoData>();
    }
}

class DmC_info_info extends egret.DisplayObjectContainer{
    private _data:DmC_info_infoData;
    private bj:egret.Bitmap;
    private _type:egret.TextField;
    private _matchText:egret.TextField;

    constructor(){
        super();

        this.bj = new egret.Bitmap();
        this.addChild(this.bj);
        RES.getResByUrl("resource/assets/images/ui/dgbg_button@2x.png",(e)=>{
            this.bj.$setBitmapData(e);
        },this);

        this._type = ToolMrg.getText(20,0,22,0x21b037);
        this._type.height = 48;
        this._type.verticalAlign = egret.VerticalAlign.MIDDLE;
        this.addChild(this._type);

        this._matchText = ToolMrg.getText(112,0,22,0x333333);
        this.addChild(this._matchText);
        this._matchText.height = 48;
        this._matchText.verticalAlign = egret.VerticalAlign.MIDDLE;
    }

    public aa(data:DmC_info_infoData):void{
        this._data = data;

        this._type.text = `${data.type}`;
        this._matchText.text = `${data.team1} VS ${data.team2}`;
    }

}

class DmC_info_infoData{
    public id;
    public type:string;
    public team1:string;
    public team2:string;
}