/**篮 串关 */
class B1infoTop extends egret.DisplayObjectContainer{
    /**true收起 false展开 默认展开形式 */
    private _type=false;
    private _title:egret.TextField;
    private _topImg:egret.Bitmap;

    /**子类info */
    private _item:GHashMap<B1info_subInfo>;

    constructor(){
        super();

        this._item = new GHashMap<B1info_subInfo>();

        this._title = ToolMrg.getText(244,0,20,0x333333);
        this.addChild(this._title);
        this._title.height = 48;
        this._title.verticalAlign = egret.VerticalAlign.MIDDLE;

        this._topImg = new egret.Bitmap();
        this.addChild(this._topImg);
        this._topImg.x = 484;
        this._topImg.y = 20;
        RES.getResByUrl("resource/assets/images/ui/xiala_nav@2x.png",(e)=>{
            this._topImg.$setBitmapData(e);
        },this);
        
        this.setDB();
    }

    private _topImgX=0;
    private _data:GHashMap<BasketballData>;
    public aa(data:GHashMap<BasketballData>,key):void{
        this._data = data;
        this._type = false;
        this._title.text = `${key}  共${data.size}场`;
        this._topImg.x = this._title.x + this._title.textWidth + 8;
        this._topImgX = this._topImg.x;//记录当前x

        let objHeight = 48;
        for(let key of data.keys){
            let obj:B1info_subInfo;
            if(this._item.GhasKey(key)){
                obj = this._item.Gget(key);
            }else{
                obj = new B1info_subInfo();
                this._item.Gput(key,obj);
            }
            obj.aa(data.Gget(key));
            obj.y = objHeight;
            objHeight = objHeight + obj.height;
            if(obj.parent==undefined)
                this.addChild(obj);
        }
        ToolMrg.upItemofGHashMap(this._item,data);
    }

    //收起 展开显示
    private changeUpDown():void{
        if(this._type){//展开
            this._type = false;

        }else{//收起
            this._type = true;

        }
    }

    public getSubItem():GHashMap<B1info_subInfo>{
        return this._item;
    }

    private _mShareC: egret.Shape;
	/**适配处理 */
	private setDB(): void {
		this._mShareC = new egret.Shape();
		this._mShareC.graphics.beginFill(0xF5F5F7, 1);
		this._mShareC.graphics.drawRect(0, 0, GameMain.getInstance.StageWidth,48);
		this.addChildAt(this._mShareC, 0);
        this._mShareC.touchEnabled = true;
        this._mShareC.addEventListener(egret.TouchEvent.TOUCH_TAP,this.changeUpDown,this);
    }
}

class B1info_subInfo extends egret.DisplayObjectContainer{
    private _typeText:egret.TextField;
    private _dayOfcodeText:egret.TextField;
    private _endTime:egret.TextField;
    private _rangeText:egret.TextField;
    
    private _shapeItem:GHashMap<BasketballBlock>;

    constructor(){
        super();
        this.addedge();

        this._shapeItem = new GHashMap<BasketballBlock>();

        this._typeText = ToolMrg.getText(26,24,24,0xff7000);
        this.addChild(this._typeText);
        this._typeText.height = 34;
        this._typeText.verticalAlign = egret.VerticalAlign.MIDDLE;

        this._dayOfcodeText = ToolMrg.getText(26,86,20,0x999999);
        this.addChild(this._dayOfcodeText);
        this._dayOfcodeText.height = 28;
        this._dayOfcodeText.verticalAlign = egret.VerticalAlign.MIDDLE;
        
        this._endTime = ToolMrg.getText(26,140,20,0x999999);
        this.addChild(this._endTime);
        this._endTime.height = 28;
        this._endTime.verticalAlign = egret.VerticalAlign.MIDDLE;

        let vs = ToolMrg.getText(392,57,24,0x999999);
        this.addChild(vs);
        vs.text = "VS";

        let zhu = ToolMrg.getText(394,135,24,0xf72e52);
        this.addChild(zhu);
        zhu.text = "主";

        this._rangeText = ToolMrg.getText(355,162,20,0xf72e52,100);
        this.addChild(this._rangeText);
        this._rangeText.textAlign = egret.HorizontalAlign.CENTER;

        for(let i=0;i<2;i++){
            let obj = new BasketballBlock(i,160,80,0x979797,0xf5f5f7,7,45);
            this._shapeItem.Gput(i,obj);
            this.addChild(obj);
            obj.x = 196+i*260;
            obj.y = 28;
        }

        for(let i=2;i<4;i++){
            let obj = new BasketballBlock(i,160,80,0x6EC858,0xF7FCF5,7,45);
            this._shapeItem.Gput(i,obj);
            this.addChild(obj);
            obj.x = 196+(i-2)*260;
            obj.y = 116;
        }

        //--边
        this.setDB();
    }
    public id;
    private _data:BasketballData;
    public aa(data:BasketballData):void{
        this._data = data;
        this.id = data.id;

        this._typeText.text = `${data.league_name}`;
        this._dayOfcodeText.text = `${data.day} ${data.code}`;
        this._endTime.text = `截止 ${data.stop}`;
        if(data.lot_lose>0)
            this._rangeText.textColor = 0xf72e52;
        else
            this._rangeText.textColor = 0x1BA22E;
        this._rangeText.text = `${data.lot_lose}`;

        for(let key of this._shapeItem.keys){
            this._shapeItem.Gget(key).addInterception();
        }
        this._tipText.addEventListener(egret.TouchEvent.TOUCH_TAP,this.touchDown,this);

        this._shapeItem.Gget(0).aa(data.id,data.team_a_name,`客胜${data.listSX[0]}`);
        this._shapeItem.Gget(1).aa(data.id,data.team_b_name,`主胜${data.listSX[1]}`);
        this._shapeItem.Gget(2).aa(data.id,data.team_a_name,`客胜${data.listSX[2]}`);
        this._shapeItem.Gget(3).aa(data.id,data.team_b_name,`主胜${data.listSX[3]}`);
    }

    public clear():void{
        for(let key of this._shapeItem.keys){
            this._shapeItem.Gget(key).clear();
        }
    }

    public changeText(num:number):void{
        this._boxShape.graphics.clear();
        if(num>0){
            this._tipText.text = `已选\n中${num}\n项`;
            this._tipText.textColor = 0xffffff;
            this._boxShape.graphics.beginFill(0xF72E52);
            this._boxShape.graphics.drawRoundRect(644,28,80,168,20);
        }else{
            this._tipText.text = `更多\n玩法`;
            this._tipText.textColor = 0x72e52;
            this._boxShape.graphics.beginFill(0xf5f5f7);
            this._boxShape.graphics.drawRoundRect(645.5,29.5,77,165,20);
        }
    }

    private touchDown(e:egret.TouchEvent):void{
        if(e.target == this._tipText){//进入更多玩法

        }
    }

    private _boxShape:egret.Shape;
    private _tipText:egret.TextField;
    /**边 117高度 */
    private addedge():void{
        let shape = new egret.Shape();
        this.addChild(shape);
        shape.graphics.beginFill(0xdedede);
        shape.graphics.drawRect(0,223.5,750,1.5);

        let box = new egret.Shape();
        this.addChild(box);
        box.graphics.beginFill(0x979797);
        box.graphics.drawRoundRect(644,28,80,168,20);

        this._boxShape = new egret.Shape();
        this.addChild(this._boxShape);
        this._boxShape.graphics.beginFill(0xf5f5f7);
        this._boxShape.graphics.drawRoundRect(645.5,29.5,77,165,20);

        this._tipText = ToolMrg.getText(644,28,20,0x72e52,80);
        this.addChild(this._tipText);
        this._tipText.height = 168;
        this._tipText.lineSpacing = 8;
        this._tipText.verticalAlign = egret.VerticalAlign.MIDDLE;
        this._tipText.textAlign = egret.HorizontalAlign.CENTER;
        this._tipText.text = "更多\n玩法";

    }

    private _mShareC: egret.Shape;
	/**适配处理 */
	private setDB(): void {
		this._mShareC = new egret.Shape();
		this._mShareC.graphics.beginFill(0xffffff, 1);
		this._mShareC.graphics.drawRect(0, 0, GameMain.getInstance.StageWidth,225);
		this.addChildAt(this._mShareC, 0);
    }

    public removeInterception():void{
        for(let key of this._shapeItem.keys){
            this._shapeItem.Gget(key).removeInterception();
            this._tipText.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.touchDown,this);
        }
    }
}