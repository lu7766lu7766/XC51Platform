/**
 * 支付界面
 */
class PaymentWnd extends egret.DisplayObjectContainer{
    private static _mInstance: PaymentWnd;
	public static get getInstance(): PaymentWnd {
		if (PaymentWnd._mInstance == undefined)
			PaymentWnd._mInstance = new PaymentWnd();
		return PaymentWnd._mInstance;
	}

    private _topUI:TopUI;
    private _return:egret.Shape;

	/**全部信息 滚动 */
	private _mContainQB:egret.DisplayObjectContainer;
    private _scroViewQB:egret.ScrollView;

	/**列表 */
	private _mList:GHashMap<HistoryAwardsData>;
	private _mListObj:GHashMap<HistoryAwardsObj>;

	/**背景 */
	private _mBg:egret.Shape;
	/**标题 */
	private _mTitle:egret.TextField;
	/**下注信息 */
	private _mXZDesc:egret.TextField;
	/**我已满18周岁并同意《彩票代购协议》 */
	private _mTip:egret.TextField;

	/**期号信息 */
	private _mQH:egret.TextField;
	/**icon */
	private _mIcon:egret.Bitmap;
	private _mGou:egret.Bitmap;
	private _LsrcItem3 = ["实际支付: ","可用余额: "];
	private _mListTiao:GHashMap<TiaoBoj1>;
	/**确定支付按钮背景 */
	private _mBuyBG:egret.Bitmap;
	/**确认支付 */
	private _mQRZF:egret.TextField;

    constructor(){
        super();
        this.y = 40;
        this._topUI = new TopUI("",-this.y);
		this._topUI.changeTitle("");
        this.addChild(this._topUI);
        this._return = this._topUI.getReturn();
        this._return.addEventListener(egret.TouchEvent.TOUCH_TAP,()=>{
            this.hide();
        },this);

		this._mContainQB = new egret.DisplayObjectContainer();
		this._scroViewQB = new egret.ScrollView();
		this.addChild(this._scroViewQB)
        this.addScoll(this._mContainQB,this._scroViewQB);

		this.setDB()
		this.touchEnabled = true;

		this._mList = new GHashMap<HistoryAwardsData>();
		this._mListObj = new GHashMap<HistoryAwardsObj>();
		this._mListTiao = new GHashMap<TiaoBoj1>();
		
		this._mBg = new egret.Shape();
		this.addChild(this._mBg);
		this._mBg.graphics.beginFill(0xffffff);
		this._mBg.graphics.drawRect(0,136 - this.y,GameMain.getInstance.StageWidth,178);

		this._mGou = new egret.Bitmap();
		this.addChild(this._mGou);
		this._mIcon = new egret.Bitmap();
		this.addChild(this._mIcon);
		this._mBuyBG = new egret.Bitmap();
		this._mBuyBG.touchEnabled = true;
		this.addChild(this._mBuyBG);

		RES.getResByUrl("resource/assets/images/ui/select2_home@2x.png",(e)=>{
			this._mGou.$setBitmapData(e);
			this._mGou.x = 32;
			this._mGou.y = 580 - this.y;
		},this);
		RES.getResByUrl("resource/assets/images/ui/bg_button@2x.png",(e)=>{
			this._mBuyBG.$setBitmapData(e);
			this._mBuyBG.x = 20;
			this._mBuyBG.y = 642 - this.y;
		},this);
		if(this._mTip == undefined)
			this._mTip = ToolMrg.getText(62,580 - this.y,24,0x333333,500);
		this._mTip.textFlow = <Array<egret.ITextElement>>[
			{ text: "我已满18周岁并同意", style: { "textColor": 0x333333} },
			{ text: "《彩票代购协议》", style: { "textColor": 0xff0000} }
		];
		this.addChild(this._mTip);
		if(this._mQRZF == undefined)
			this._mQRZF = ToolMrg.getText(304,672 - this.y,36,0xFFFFFF,144);
		this._mQRZF.text = "确认支付";
		this.addChild(this._mQRZF);
    }

	private addScoll(contain:egret.DisplayObjectContainer,scroView:egret.ScrollView): void {
		scroView.x = 0;
		scroView.y = 136 - this.y;
		scroView.scrollSpeed = 0.4;
		//设置滚动内容
		scroView.setContent(contain);
		scroView.bounces = false;
		scroView.verticalScrollPolicy = 'on';
		scroView.horizontalScrollPolicy = 'off';
		//设置滚动区域宽高
		scroView.width = GameMain.getInstance.StageWidth;
		scroView.height = GameMain.getInstance.StageHeight - 134;
	}

	private _mShareC: egret.Shape;
	/**适配处理 */
	private setDB(): void {
		this._mShareC = new egret.Shape();
		this._mShareC.graphics.beginFill(0xF5F5F7, 1);
		this._mShareC.graphics.drawRect(0, 0, GameMain.getInstance.StageWidth,GameMain.getInstance.StageHeight);
		this._mShareC.graphics.endFill();
		this.addChildAt(this._mShareC, 0);
    }

    private touchDown(e:egret.TouchEvent):void{
		if(e.target == this._mBuyBG) {
			this._mData.backFun.call(this._mData.thisObj);
		}
    }

	private _mData:PaymentData;
    public show(data:PaymentData):void{
		if(data == undefined) {
			return;
		}
		this._mData = data;
		this._topUI.changeTitle(this._mData.title);
		RES.getResByUrl("resource/assets/images/ui/"+this._mData.iconUrl,(e)=>{
			this._mIcon.$setBitmapData(e);
			this._mIcon.width = 96;
			this._mIcon.height = 96;
			this._mIcon.x = 28;
			this._mIcon.y = 178 - this.y;
		},this);

		if(this._mTitle == undefined)
			this._mTitle = ToolMrg.getText(144,213 - this.y,32,0x333333,200);
		this._mTitle.text = this._mData.typeDesc;
		this.addChild(this._mTitle);
		if(this._mXZDesc == undefined)
			this._mXZDesc = ToolMrg.getText(144,234 - this.y,28,0x999999,200);
		// this._mXZDesc.text = this._mData.tz +"注 "+this._mData.bs+"倍 共￥"+this._mData.xzM;
		this.addChild(this._mXZDesc);
		if(this._mQH == undefined)
			this._mQH = ToolMrg.getText(526,213 - this.y,28,0x333333,200);
		this._mQH.textAlign = egret.HorizontalAlign.RIGHT;
		this._mQH.text = "期号: 第"+this._mData.qs+"期";
		this.addChild(this._mQH);

		let obj:TiaoBoj1;
		for(let i=0;i<this._LsrcItem3.length;i++) {
			if(this._mListTiao.GhasKey(i)) {
				obj = this._mListTiao.Gget(i);
			} else {
				obj = TiaoBoj1.getObj();
				this._mListTiao.Gput(i,obj);
			}
			if(i==0) {
				obj.init(this._LsrcItem3[i] ,"￥"+this._mData.xzM,0xF72E52);
			} else {
				obj.init(this._LsrcItem3[i] , 1189+"元", 0x333333);
			}
			obj.y = 326 - this.y + i*110;
			this.addChild(obj);
		}

		this._mBuyBG.addEventListener(egret.TouchEvent.TOUCH_TAP,this.touchDown,this);

        GUIManager.getInstance.tipLay.addChild(this);
    }
	
    public hide():void{
		this._mBuyBG.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.touchDown,this);

        if(this.parent!=undefined){
            this.parent.removeChild(this);
        }

		let obj:HistoryAwardsObj;
		for(let key of this._mListObj.keys) {
			obj = this._mListObj.Gget(key);
			GObjPool.getInstance.Gadd2Pool(obj);
			obj.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.touchDown,this);
			if(obj.parent != undefined) {
				obj.parent.removeChild(obj);
			}
		}

		this._mListObj.clear();
    }
}

/**支付数据类 */
class PaymentData {
	/**足球支付类型 */
	public static zqType:number = 1;
	/**篮球支付类型 */
	public static lqType:number = 2;
	/**组3支付类型 */
	public static z3Type:number = 3;
	/**组5支付类型 */
	public static z5Type:number = 4;

	/**类型 */
	public type:number;
	/**标题 */
	public title:string;
	/**类型描述 */
	public typeDesc:string;
	/**icon名 */
	public iconUrl:string;
	// /**投注 */
	// public tz:number;
	// /**倍数 */
	// public bs:number;
	/**下注金额 */
	public xzM:number;
	/**期数 */
	public qs:number;

	thisObj:any;
	backFun:Function;
}

/**一条对象 */
class TiaoBoj1 extends egret.DisplayObjectContainer implements GIObjPool{
	public static getObj(): TiaoBoj1 {
		let obj = GObjPool.getInstance.GgetObj(TiaoBoj1);
		if (obj == null)
			obj = new TiaoBoj1();
		return obj;
	}

	/**标题 */
	private _mTitle:egret.TextField;
	/**钱 */
	private _mJQ:egret.TextField;

	private constructor() {
		super();
		this.touchEnabled = true;
		let link2 = new egret.Shape();
		link2.graphics.beginFill(0xffffff);
		link2.graphics.drawRect(0,0,GameMain.getInstance.StageWidth,108);
		link2.graphics.endFill();
		this.addChild(link2);
	}

	public init(str:string ,m:string, color:number):void {
		if(this._mTitle == undefined)
			this._mTitle = ToolMrg.getText(26,38,28,0x333333,200);
		this._mTitle.text = str;
		this.addChild(this._mTitle);

		if(this._mJQ == undefined) 
			this._mJQ = ToolMrg.getText(526,40,24,color,200);
		this._mJQ.textAlign = egret.HorizontalAlign.RIGHT;
		this._mJQ.text = m;
		this.addChild(this._mJQ);

	}

	public clean(): void {
		egret.Tween.removeTweens(this);
		this._mTitle.text = "";
		this._mJQ.text = "";
	}
}