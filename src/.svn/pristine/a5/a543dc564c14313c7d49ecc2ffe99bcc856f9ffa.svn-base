/**
 * 我的彩票
 */
class MyLotteryWnd extends egret.DisplayObjectContainer{
    private static _mInstance: MyLotteryWnd;
	public static get getInstance(): MyLotteryWnd {
		if (MyLotteryWnd._mInstance == undefined)
			MyLotteryWnd._mInstance = new MyLotteryWnd();
		return MyLotteryWnd._mInstance;
	}
	/**全部信息 滚动 */
	private _mContainQB:egret.DisplayObjectContainer;
    private _scroViewQB:egret.ScrollView;
	/**待开奖信息 滚动 */
	private _mContainDKJ:egret.DisplayObjectContainer;
    private _scroViewQBDKJ:egret.ScrollView;
	/**已开奖信息 滚动 */
	private _mContainYKJ:egret.DisplayObjectContainer;
    private _scroViewQBYKJ:egret.ScrollView;
	/**已中奖信息 滚动 */
	private _mContainYZJ:egret.DisplayObjectContainer;
    private _scroViewQBYZJ:egret.ScrollView;

    private _topUI:TopUI;
    private _return:egret.Shape;
	/**当前选中 */
	private _mXZLink:egret.Shape;

	/**暂无数据提示 */
	private _mZWSJTip:egret.TextField;

	private _srcItem = ["全部","待开奖","已开奖","已中奖"];
    private _index = 0;

    constructor(){
        super();
        this.y = 40;
        this._topUI = new TopUI("",-this.y);
		this._topUI.changeTitle("我的彩票");
        this.addChild(this._topUI);
        this._return = this._topUI.getReturn();
        this._return.addEventListener(egret.TouchEvent.TOUCH_TAP,()=>{
            this.hide();
        },this);

		this._mContainQB = new egret.DisplayObjectContainer();
		this._scroViewQB = new egret.ScrollView();
        this.addScoll(this._mContainQB,this._scroViewQB);

		this._mContainDKJ = new egret.DisplayObjectContainer();
		this._scroViewQBDKJ = new egret.ScrollView();
        this.addScoll(this._mContainDKJ,this._scroViewQBDKJ);

		this._mContainYKJ = new egret.DisplayObjectContainer();
		this._scroViewQBYKJ = new egret.ScrollView();
        this.addScoll(this._mContainYKJ,this._scroViewQBYKJ);

		this._mContainYZJ = new egret.DisplayObjectContainer();
		this._scroViewQBYZJ = new egret.ScrollView();
        this.addScoll(this._mContainYZJ,this._scroViewQBYZJ);

		this.init();
		this.setDB()

		this.touchEnabled = true;

		this._mZWSJTip = ToolMrg.getText(0,(GameMain.getInstance.StageHeight - 216) * 0.5,30,0x000000,GameMain.getInstance.StageWidth);
		this._mZWSJTip.height = 50;
		this._mZWSJTip.textAlign = egret.HorizontalAlign.CENTER;
		this._mZWSJTip.verticalAlign = egret.VerticalAlign.MIDDLE;
		this._mZWSJTip.text = "暂无数据";
		this.addChild(this._mZWSJTip);
    }

	private addScoll(contain:egret.DisplayObjectContainer,scroView:egret.ScrollView): void {
		scroView.x = 0;
		scroView.y = 218 - this.y;
		scroView.scrollSpeed = 0.4;
		//设置滚动内容
		scroView.setContent(contain);
		scroView.bounces = false;
		scroView.verticalScrollPolicy = 'on';
		scroView.horizontalScrollPolicy = 'off';
		//设置滚动区域宽高
		scroView.width = GameMain.getInstance.StageWidth;
		scroView.height = GameMain.getInstance.StageHeight - 216;
	}

	private init():void {
		let link = new egret.Shape();
        this.addChild(link);
        link.graphics.beginFill(0xdedede);
        link.graphics.drawRect(0,136 + this.y,750,1.5);

		this._mXZLink = new egret.Shape();
        this.addChild(this._mXZLink);
        this._mXZLink.graphics.beginFill(0xF72D52);
        this._mXZLink.graphics.drawRect(71,212 - this.y,48,4);

		for(let i=0;i<this._srcItem.length;i++){
            let text:egret.TextField = ToolMrg.getText(i*187.5,136 - this.y,26,0x292929,187.5);
			text.height = 80;
            text.textAlign = egret.HorizontalAlign.CENTER;
			text.verticalAlign = egret.VerticalAlign.MIDDLE;
            text.text = this._srcItem[i];
			this.addChild(text);
			text.touchEnabled = true;
			text.addEventListener(egret.TouchEvent.TOUCH_TAP,this.touchDown,this);
        }
	}

	private _mShareC: egret.Shape;
	/**适配处理 */
	private setDB(): void {
		this._mShareC = new egret.Shape();
		this._mShareC.graphics.beginFill(0xffffff, 1);
		this._mShareC.graphics.drawRect(0, 0, GameMain.getInstance.StageWidth,GameMain.getInstance.StageHeight);
		this.addChildAt(this._mShareC, 0);
    }

	/**切换按钮 */
	public changeWnd(index:number):void {
		// this._mXZLink.x = index * 150
		egret.Tween.removeTweens(this._mXZLink)
		egret.Tween.get(this._mXZLink).to({x:index * 187.5},100);
		if(index == 0) {
			this.showOrHide(true, false, false, false);

			this.showData(MyLotteryDataMrg.getInstance.getAllList(), this._mContainQB);
		} else if(index == 1) {
			this.showOrHide(false, true, false, false);

			this.showData(MyLotteryDataMrg.getInstance.getDKJDataList(), this._mContainDKJ);
		} else if(index == 2) {
			this.showOrHide(false, false, true, false);

			this.showData(MyLotteryDataMrg.getInstance.getYKJDataList(), this._mContainYKJ);
		} else if(index == 3) {
			this.showOrHide(false, false, false, true);

			this.showData(MyLotteryDataMrg.getInstance.getYZJDataList(), this._mContainYZJ);
		}
		this._scroViewQB.setScrollTop(0);
		this._scroViewQBDKJ.setScrollTop(0);
		this._scroViewQBYKJ.setScrollTop(0);
		this._scroViewQBYZJ.setScrollTop(0);
	}

	/**展示或移除 */
	private showOrHide(qb:boolean, dkj:boolean, ykj:boolean, yzj:boolean):void {
		if(qb == true) {
			this.addChildAt(this._scroViewQB,1);
		} else {
			if(this._scroViewQB.parent != undefined) {
				this._scroViewQB.parent.removeChild(this._scroViewQB);
			}
		}

		if(dkj == true) {
			this.addChildAt(this._scroViewQBDKJ,1);
		} else {
			if(this._scroViewQBDKJ.parent != undefined) {
				this._scroViewQBDKJ.parent.removeChild(this._scroViewQBDKJ);
			}
		}

		if(ykj == true) {
			this.addChildAt(this._scroViewQBYKJ,1);
		} else {
			if(this._scroViewQBYKJ.parent != undefined) {
				this._scroViewQBYKJ.parent.removeChild(this._scroViewQBYKJ);
			}
		}

		if(yzj == true) {
			this.addChildAt(this._scroViewQBYZJ,1);
		} else {
			if(this._scroViewQBYZJ.parent != undefined) {
				this._scroViewQBYZJ.parent.removeChild(this._scroViewQBYZJ);
			}
		}
	}

	/**展示对应的数据 */
	public showData(listData:Array<MyLotteryData>, contain:egret.DisplayObjectContainer):void {
		for(let i=0;i<listData.length;i++) {
			if(listData[i] != undefined) {
				let obj:MyLotteryObj = MyLotteryObj.getObj();
				obj.init(listData[i]);
				obj.y = i*110;
				this._mContainQB.addChild(obj);
			}
		}

		if(listData.length <= 0) {
			this._mZWSJTip.visible = true;
		} else {
			this._mZWSJTip.visible = false
		}
	}

    private touchDown(e:egret.TouchEvent):void{
		if(e.target instanceof egret.TextField) {
			let touch:egret.TextField = e.target;
			if(touch.text == this._srcItem[0]) {//全部
				this.changeWnd(0);
			} else if(touch.text == this._srcItem[1]) {//待开奖
				this.changeWnd(1);
			} else if(touch.text == this._srcItem[2]) {//已开奖
				this.changeWnd(2);
			} else if(touch.text == this._srcItem[3]) {//已中奖
				this.changeWnd(3);
			}
		}
    }


    public show(index?:number):void{
        GUIManager.getInstance.tipLay.addChild(this);
		if(index != undefined) {
			this.changeWnd(index);
		} else {
			this.changeWnd(0);
		}
    }

    public hide():void{
        if(this.parent!=undefined){
            this.parent.removeChild(this);
        }
    }
}