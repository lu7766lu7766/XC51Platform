/**
 * 
登陆
http://129.204.53.154/other/test/regist.php?username=&pass=&p=  
username=>用户名   pass=>密码    p=>邀请码（如果邀请码不填，默认发0）
返回
{
     "res": 0,
        "id": "12", //用户ID
        "username": "1234",  //用户昵称同时是用户账号
        "pass": "1111234567891001",  //密码
        "award": "0",  //中奖余额
        "bmoney": "0",  //佣金余额
        "isb": 0   //是否霸占全部佣金 0:否 1:是

}
 */
class RegistPhp implements IProHandle {
	private static _mInstance: RegistPhp;
	public static get getInstance(): RegistPhp {
		if (RegistPhp._mInstance == undefined)
			RegistPhp._mInstance = new RegistPhp();
		return RegistPhp._mInstance;
	}
	/**对象key */
	private data: HttpData;
	private constructor() {
		this.data = new HttpData();
		this.data.mKey = "RegistPhp";
	}

	/**
	 * user
	 */
	public sendHttp(username:string,pass:string,p:string): void {
		let url: string = HTTPRequest.getInstance.httpHeadUrl + "/regist.php";

		let content = `username=${username}&pass=${pass}&p=${p}`;
		HTTPRequest.getInstance.proSend(url, content, this.data);
	}

	public backHTTP(res: boolean, httpObj: egret.HttpRequest, data: HttpData): void {
        if (res == true && httpObj.response != "") {//请求成功
            let text: Object;
            try {
				text = JSON.parse(httpObj.response);
			} catch (error) {
				Alertpaner.getInstance.show(error);
				return;
			}
            if(text["res"]!="0"){
                Alertpaner.getInstance.show(text["res"]+":"+text["msg"]);
			} else if(text["res"] == "0"){
				UserData.getInstance.userName = text["username"];
				UserData.getInstance.setYJTime(text["id"], text["username"],text["pass"]);
				UserData.getInstance.setGold(text["award"]);
				UserData.getInstance.setYJGold(text["bmoney"]);
				GameValue.isBZQBYJ = Number(text["isb"]);

				LoginWnd.getInstance.hide();
				RegisterWnd.getInstance.hide();
			}
			
        }
    }
}