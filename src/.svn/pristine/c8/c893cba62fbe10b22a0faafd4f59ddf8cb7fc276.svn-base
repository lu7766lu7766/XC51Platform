/**足 胜平负 */
class G2infoTop extends egret.DisplayObjectContainer{
    /**true收起 false展开 默认展开形式 */
    private _type=false;
    private _title:egret.TextField;
    private _topImg:egret.Bitmap;

    /**子类info */
    private _item:GHashMap<G2info_subInfo>;

    constructor(){
        super();
        this._item = new GHashMap<G2info_subInfo>();

        this._title = ToolMrg.getText(244,0,20,0x333333);
        this.addChild(this._title);
        this._title.height = 48;
        this._title.verticalAlign = egret.VerticalAlign.MIDDLE;

        this._topImg = new egret.Bitmap();
        this.addChild(this._topImg);
        this._topImg.x = 484;
        this._topImg.y = 20;
        RES.getResByUrl("resource/assets/images/ui/xiala_nav@2x.png",(e)=>{
            this._topImg.$setBitmapData(e);
        },this);
        
        this.setDB();
    }

    private _topImgX=0;
    private _data:GHashMap<FootballData>;
    public aa(data:GHashMap<FootballData>,key):void{
        this._data = data;
        this._type = false;
        this._title.text = `${key}  共${data.size}场`;
        this._topImg.x = this._title.x + this._title.textWidth + 8;
        this._topImgX = this._topImg.x;//记录当前x

        let objHeight = 48;
        for(let key of data.keys){
            let obj:G2info_subInfo;
            if(this._item.GhasKey(key)){
                obj = this._item.Gget(key);
            }else{
                obj = new G2info_subInfo();
                this._item.Gput(key,obj);
            }
            obj.aa(data.Gget(key));
            obj.y = objHeight;
            objHeight = objHeight + obj.height;
            if(obj.parent==undefined)
                this.addChild(obj);
        }
        ToolMrg.upItemofGHashMap(this._item,data);
    }

    //收起 展开显示
    private changeUpDown():void{
        if(this._type){//展开
            this._type = false;

            for(let key of this._item.keys){
                let obj = this._item.Gget(key);
                if(obj.parent==undefined)
                    this.addChild(obj);
            }
        }else{//收起
            this._type = true;

            for(let key of this._item.keys){
                let obj = this._item.Gget(key);
                if(obj.parent!=undefined)
                    this.removeChild(obj);
            }
        }
        G2Wnd.getInstance.changeItemHeight();
    }

    private _isInterception = false;
    public addInterception():void{
        if(!this._isInterception){
            this._mShareC.addEventListener(egret.TouchEvent.TOUCH_TAP,this.changeUpDown,this);
            this._isInterception = true;
        }
    }

    public removeInterception():void{
        if(this._isInterception){
            this._mShareC.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.changeUpDown,this);
            this._isInterception = false;
        }
    }

    public getSubItem():GHashMap<G2info_subInfo>{
        return this._item;
    }

    private _mShareC: egret.Shape;
	/**适配处理 */
	private setDB(): void {
		this._mShareC = new egret.Shape();
		this._mShareC.graphics.beginFill(0xF5F5F7, 1);
		this._mShareC.graphics.drawRect(0, 0, GameMain.getInstance.StageWidth,48);
		this.addChildAt(this._mShareC, 0);
        this._mShareC.touchEnabled = true;
    }
}

class G2info_subInfo extends egret.DisplayObjectContainer{
    private _team1:egret.TextField;
    private _team2:egret.TextField;
    private _typeText:egret.TextField;
    private _dayOfcodeText:egret.TextField;
    private _endTime:egret.TextField;
    private _lBtn:egret.Bitmap;
    private _rangShape:egret.Shape;
    private _norangText:egret.TextField;
    private _rangText:egret.TextField;
    /**选中 */
    public strMap:GHashMap<number>;
    private _shapeItem:GHashMap<Block>;

    private _p1Shape:egret.Shape;
    private _p1Text:egret.TextField;
    private _p2Shape:egret.Shape;
    private _p2Text:egret.TextField;

    constructor(){
        super();
        this.addedge();

        this._p1Shape = new egret.Shape();
        this.addChild(this._p1Shape);
        this._p1Shape.graphics.beginFill(0x979797);
        this._p1Shape.graphics.drawRect(201.5,70,417,58);

        let p1Shape = new egret.Shape();
        this.addChild(p1Shape);
        p1Shape.graphics.beginFill(0xffffff);
        p1Shape.graphics.drawRect(203,71.5,414,55);

        this._p1Text = ToolMrg.getText(201.5,70,24,0x999999,420);
        this.addChild(this._p1Text);
        this._p1Text.height = 56;
        this._p1Text.verticalAlign = egret.VerticalAlign.MIDDLE;
        this._p1Text.textAlign = egret.HorizontalAlign.CENTER;
        this._p1Text.text = "暂未开盘";

        this._p2Shape = new egret.Shape();
        this.addChild(this._p2Shape);
        this._p2Shape.graphics.beginFill(0x979797);
        this._p2Shape.graphics.drawRect(201.5,70+58-1.5,417,58);

        let p2Shape = new egret.Shape();
        this.addChild(p2Shape);
        p2Shape.graphics.beginFill(0xffffff);
        p2Shape.graphics.drawRect(203,71.5+58-1.5,414,55);

        this._p2Text = ToolMrg.getText(201.5,70+58-1.5,24,0x999999,420);
        this.addChild(this._p2Text);
        this._p2Text.height = 56;
        this._p2Text.verticalAlign = egret.VerticalAlign.MIDDLE;
        this._p2Text.textAlign = egret.HorizontalAlign.CENTER;
        this._p2Text.text = "暂未开盘";

        this.strMap = new GHashMap<number>();
        this._shapeItem = new GHashMap<Block>();

        this._typeText = ToolMrg.getText(26,24,24,0xff7000);
        this.addChild(this._typeText);
        this._typeText.height = 34;
        this._typeText.verticalAlign = egret.VerticalAlign.MIDDLE;

        this._dayOfcodeText = ToolMrg.getText(26,86,20,0x999999);
        this.addChild(this._dayOfcodeText);
        this._dayOfcodeText.height = 28;
        this._dayOfcodeText.verticalAlign = egret.VerticalAlign.MIDDLE;
        
        this._endTime = ToolMrg.getText(26,140,20,0x999999);
        this.addChild(this._endTime);
        this._endTime.height = 28;
        this._endTime.verticalAlign = egret.VerticalAlign.MIDDLE;

        let vs = ToolMrg.getText(408,27,24,0x999999);
        this.addChild(vs);
        vs.text = "VS";

        this._team1 = ToolMrg.getText(102,22,24,0x333333,250);
        this.addChild(this._team1);
        this._team1.height = 34;
        this._team1.textAlign = egret.HorizontalAlign.RIGHT;
        this._team1.verticalAlign = egret.VerticalAlign.MIDDLE;

        this._team2 = ToolMrg.getText(490,22,24,0x333333);
        this.addChild(this._team2);
        this._team2.height = 34;
        this._team2.verticalAlign = egret.VerticalAlign.MIDDLE;
        
        this._lBtn = new egret.Bitmap();
        this.addChild(this._lBtn);
        this._lBtn.x = 692;
        this._lBtn.y = 18;
        RES.getResByUrl("resource/assets/images/ui/liao_expert@2x.png",(e)=>{this._lBtn.$setBitmapData(e); },this);

        this._norangText = ToolMrg.getText(160,68,20,0xffffff,40);
        this.addChild(this._norangText);
        this._norangText.height = 115/2;
        this._norangText.verticalAlign = egret.VerticalAlign.MIDDLE;
        this._norangText.textAlign = egret.HorizontalAlign.CENTER;

        this._rangText = ToolMrg.getText(160,68+115/2,20,0xffffff,40);
        this.addChild(this._rangText);
        this._rangText.height = 115/2;
        this._rangText.verticalAlign = egret.VerticalAlign.MIDDLE;
        this._rangText.textAlign = egret.HorizontalAlign.CENTER;

        for(let i=0;i<6;i++){
            let obj = new Block(i,140,58);
            this.addChild(obj);
            if(i<3){
                obj.x = 201.5+(140-2)*i;
                obj.y = 70;
            }else{
                obj.y = 70+58-1.5;
                obj.x = 201.5+(140-2)*(i-3);
            }
            this._shapeItem.Gput(i,obj);
        }
        //--边
        this.setDB();
    }
    public id;
    private _data:FootballData;
    public aa(data:FootballData):void{
        this._data = data;
        this.id = data.id;

        this._typeText.text = `${data.league_name}`;
        this._dayOfcodeText.text = `${data.day} ${data.code}`;
        this._endTime.text = `截止 ${data.stop}`;
        this._team1.text = `${data.team_a_name}`;
        this._team2.text = `${data.team_b_name}`;

        let num = "-";
        if(data.lot_lose!=undefined)
            num = `${data.lot_lose}`;
        this._rangText.text = `${num}`;
        if(data.no_lose==undefined)
            data.no_lose = 0;
        this._norangText.text = `${data.no_lose}`;

        if(data.listSX[0] == data.listSX[1] && data.listSX[0] == data.listSX[2]){
            for(let i=0;i<3;i++){
                let obj = this._shapeItem.Gget(i);
                if(obj.parent!=undefined)
                    obj.parent.removeChild(obj);
            }
        }else{
            for(let i=0;i<3;i++){
                let obj = this._shapeItem.Gget(i);
                if(obj.parent==undefined)
                    this.addChild(obj);
            }
        }

        if(data.listSX[3] == data.listSX[4] && data.listSX[3] == data.listSX[5]){
            for(let i=3;i<6;i++){
                let obj = this._shapeItem.Gget(i);
                if(obj.parent!=undefined)
                    obj.parent.removeChild(obj);
            }
        }else{
            for(let i=3;i<6;i++){
                let obj = this._shapeItem.Gget(i);
                if(obj.parent==undefined)
                    this.addChild(obj);
            }
        }

        for(let key of this._shapeItem.keys){
            this._shapeItem.Gget(key).addInterception();
        }

        this._shapeItem.Gget(0).aa(this._data.id,`胜 ${data.listSX[0]}`);
        this._shapeItem.Gget(1).aa(this._data.id,`平 ${data.listSX[1]}`);
        this._shapeItem.Gget(2).aa(this._data.id,`负 ${data.listSX[2]}`);
        this._shapeItem.Gget(3).aa(this._data.id,`胜 ${data.listSX[3]}`);
        this._shapeItem.Gget(4).aa(this._data.id,`平 ${data.listSX[4]}`);
        this._shapeItem.Gget(5).aa(this._data.id,`负 ${data.listSX[5]}`);
    }

    public removeInterception():void{
        for(let key of this._shapeItem.keys){
            this._shapeItem.Gget(key).removeInterception();
        }
    }

    public clear():void{
        for(let key of this._shapeItem.keys){
            this._shapeItem.Gget(key).clear();
        }
        this.strMap.clear();
    }

    /**边 117高度 */
    private addedge():void{

        let norangShape = new egret.Shape();
        this.addChild(norangShape);
        norangShape.graphics.beginFill(0xFF8548);
        norangShape.graphics.drawRect(160,70,40,115/2);

        this._rangShape = new egret.Shape();
        this.addChild(this._rangShape);
        this._rangShape.graphics.beginFill(0x6EC858);
        this._rangShape.graphics.drawRect(160,70+115/2,40,115/2);

        let shape = new egret.Shape();
        this.addChild(shape);
        shape.graphics.beginFill(0xdedede);
        shape.graphics.drawRect(0,208.5,750,1.5);
    }

    private _mShareC: egret.Shape;
	/**适配处理 */
	private setDB(): void {
		this._mShareC = new egret.Shape();
		this._mShareC.graphics.beginFill(0xffffff, 1);
		this._mShareC.graphics.drawRect(0, 0, GameMain.getInstance.StageWidth,210);
		this.addChildAt(this._mShareC, 0);
    }
}